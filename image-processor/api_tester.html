<div class="container">
  <h1>Multipart File Upload</h1>
  <form id="form" enctype="multipart/form-data">
    <div class="input-group">
      <label for="files">Select files</label>
      <input id="file" type="file" />
    </div>
    <button class="submit-btn" type="submit">Upload</button>
  </form>
</div>

<script>
  class Photo {
    constructor(filename) {
      this.filename = filename;
    }
  }

  function getBase64(file) {
    return new Promise((resolve, reject) => {
      var reader = new FileReader();

      reader.readAsBinaryString(file);
      reader.onload = function () {
        const data = reader.result;
        resolve(btoa(data));
      };
      reader.onerror = reject;
    })
  }

  const form = document.getElementById("form");
  const inputFile = document.getElementById("file");

  const formData = new FormData();

  async function fetchData(baseArray) {
    var result = await fetch("https://localhost:7285/blurImage", {
      method: "post",
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        width: inputFile.files[0].width,
        height: inputFile.files[0].height,
        data: baseArray,
      })
    })

    console.log(body);
    var response = await result.json();
    console.log(response);
  }

  const handleSubmit = async (event) => {
    event.preventDefault();


    var baseArray = [];

    for (const file of inputFile.files) {
      const base = await getBase64(file);
      console.log(base);
      baseArray.push(base);
    }

    console.log(baseArray);

    await fetchData(baseArray)

  };

  form.addEventListener("submit", handleSubmit);
</script>